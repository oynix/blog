<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="避免没有计划的行动">
<meta property="og:type" content="website">
<meta property="og:title" content="oynix">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="oynix">
<meta property="og:description" content="避免没有计划的行动">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="oynix">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>oynix</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">oynix</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">github这个域名也挺好</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/oynix" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/25b397e9b664/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/25b397e9b664/" class="post-title-link" itemprop="url">React - Webpack 项目脚手架搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-07 00:28:57" itemprop="dateCreated datePublished" datetime="2021-07-07T00:28:57+08:00">2021-07-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>把手还是伸向了前端，抽空折腾了几天，算是理清了起步门槛。</p>
</blockquote>
<h5 id="一、首先确保安装了-npm，如果没装…-那就想办法装上"><a href="#一、首先确保安装了-npm，如果没装…-那就想办法装上" class="headerlink" title="一、首先确保安装了 npm，如果没装….那就想办法装上"></a>一、首先确保安装了 npm，如果没装….那就想办法装上</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ npm</span><br><span class="line">Usage: npm &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">where</span> &lt;<span class="built_in">command</span>&gt; is one of:</span><br><span class="line">    access, adduser, bin, bugs, c, cache, completion, config,</span><br><span class="line">    ddp, dedupe, deprecate, dist-tag, docs, doctor, edit,</span><br><span class="line">    explore, get, <span class="built_in">help</span>, help-search, i, init, install,</span><br><span class="line">    install-test, it, link, list, ln, login, <span class="built_in">logout</span>, ls,</span><br><span class="line">    outdated, owner, pack, ping, prefix, profile, prune,</span><br><span class="line">    publish, rb, rebuild, repo, restart, root, run, run-script,</span><br><span class="line">    s, se, search, <span class="built_in">set</span>, shrinkwrap, star, stars, start, stop, t,</span><br><span class="line">    team, <span class="built_in">test</span>, token, tst, un, uninstall, unpublish, unstar,</span><br><span class="line">    up, update, v, version, view, whoami</span><br><span class="line"></span><br><span class="line">npm &lt;<span class="built_in">command</span>&gt; -h     quick <span class="built_in">help</span> on &lt;<span class="built_in">command</span>&gt;</span><br><span class="line">npm -l           display full usage info</span><br><span class="line">npm <span class="built_in">help</span> &lt;term&gt;  search <span class="keyword">for</span> <span class="built_in">help</span> on &lt;term&gt;</span><br><span class="line">npm <span class="built_in">help</span> npm     involved overview</span><br><span class="line"></span><br><span class="line">Specify configs <span class="keyword">in</span> the ini-formatted file:</span><br><span class="line">    /Users/xiaoyu/.npmrc</span><br><span class="line">or on the <span class="built_in">command</span> line via: npm &lt;<span class="built_in">command</span>&gt; --key value</span><br><span class="line">Config info can be viewed via: npm <span class="built_in">help</span> config</span><br><span class="line"></span><br><span class="line">npm@5.6.0 /usr/<span class="built_in">local</span>/lib/node_modules/npm</span><br></pre></td></tr></table></figure>
<h5 id="二、安装-create-react-app。如果用-WebStorm，可以跳过这一步。"><a href="#二、安装-create-react-app。如果用-WebStorm，可以跳过这一步。" class="headerlink" title="二、安装 create-react-app。如果用 WebStorm，可以跳过这一步。"></a>二、安装 create-react-app。如果用 WebStorm，可以跳过这一步。</h5><blockquote>
<p>IDE 可以选择创建 React App，省去了手动执行，所以创建后的目录内容是一样的。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// -g : global</span><br><span class="line">$ npm install create-react-app -g</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/create-react-app -&gt; /usr/<span class="built_in">local</span>/lib/node_modules/create-react-app/index.js</span><br><span class="line">+ create-react-app@3.2.0</span><br><span class="line">added 91 packages <span class="keyword">in</span> 24.685s</span><br><span class="line"></span><br><span class="line">$ create-react-app</span><br><span class="line">Please specify the project directory:</span><br><span class="line">  create-react-app &lt;project-directory&gt;</span><br><span class="line"></span><br><span class="line">For example:</span><br><span class="line">  create-react-app my-react-app</span><br><span class="line"></span><br><span class="line">Run create-react-app --<span class="built_in">help</span> to see all options.</span><br></pre></td></tr></table></figure>
<p>如介绍所言，创建一个app，名字任意，合法即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ create-react-app my-react-app</span><br></pre></td></tr></table></figure>
<p>项目结构如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls my-react-app</span><br><span class="line">README.md		    package-lock.json	public</span><br><span class="line">node_modules		package.json		src</span><br></pre></td></tr></table></figure>
<ul>
<li>README.md : 你懂的</li>
<li>node_moudles : 依赖都在找个目录下</li>
<li>package.json : npm的配置文件，或者说是项目的配置文件</li>
<li>package-lock.json : 锁定版本号</li>
<li>public : 存放静态资源</li>
<li>src :  代码／资源</li>
</ul>
<h4 id="三、安装-webpack-全家桶"><a href="#三、安装-webpack-全家桶" class="headerlink" title="三、安装 webpack 全家桶"></a>三、安装 webpack 全家桶</h4><blockquote>
<p>npm install 参数说明：package.json 有几个依赖节点，<code>dependencies</code> 、 <code>devDependencies</code> 和 <code>optionalDependencies</code>，前者会随着项目发布出去；后者顾名思义，只在开发时使用；后后者为可选阶段</p>
<hr>
<p>-S， –save ：依赖添加到 <code>dependencies</code> 节点，<br>-D，–save-dev ：依赖添加到 <code>devDependencies</code> 节点<br>-O，–save-optional ：依赖添加到  <code>optionalDependencies</code> 节点</p>
</blockquote>
<p>以下命令，在项目根目录下执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 也可以放在一行执行</span><br><span class="line">$ npm install webpack -D</span><br><span class="line">$ npm install webpack-cli -D</span><br><span class="line">$ npm install webpack-dev-server -D</span><br></pre></td></tr></table></figure>
<p><strong>注意，这里有个坑：这三个依赖的版本号一定要相互匹配，如果你要指定版本，一定要确认指定的版本号是行不通的，不然就会报错。都用最新版，目前一切正常。</strong></p>
<h4 id="四、配置-webpack-server"><a href="#四、配置-webpack-server" class="headerlink" title="四、配置 webpack server"></a>四、配置 webpack server</h4><p>鉴于 webpack 可用于本地 server，也可用于打包，各自使用不同的配置文件。在项目根目录创建个文件夹 <code>wepack</code>，用于存放 webpack 配置文件。</p>
<ol>
<li>webpack/webpack.config.js，用于开发 server<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> __repo = path.dirname(__dirname);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">entry</span>: &#123; <span class="comment">// 程序唯一入口</span></span><br><span class="line">        <span class="string">&#x27;index&#x27;</span>: path.resolve(__repo, <span class="string">&#x27;src/index.jsx&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123; <span class="comment">// 打包文件输出位置</span></span><br><span class="line">        <span class="attr">path</span>: path.resolve(__repo, <span class="string">&quot;build&quot;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">        <span class="attr">publicPath</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">contentBase</span>: [path.join(__repo, <span class="string">&#x27;public&#x27;</span>),], <span class="comment">// 本地服务器索价在的页面所在目录</span></span><br><span class="line">        <span class="attr">compress</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">7788</span>, <span class="comment">// server 使用端口</span></span><br><span class="line">        <span class="attr">disableHostCheck</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">inline</span>: <span class="literal">true</span>, <span class="comment">// 实时刷新</span></span><br><span class="line">        <span class="attr">historyApiFallback</span>: <span class="literal">true</span>, <span class="comment">// 不跳转</span></span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/(\.jsx|\.js)$/</span>, <span class="comment">// 匹配所护理文件的扩展名正则表达式</span></span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 手动添加／屏蔽的文件</span></span><br><span class="line">                use: &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>, <span class="comment">// loader名称</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(css|styl)$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;style-loader&#x27;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                 ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;<span class="attr">loader</span>: <span class="string">&#x27;html-loader&#x27;</span>&#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(gif|jpg|png|svg|ttf|eot|woff|woff2)$/</span>,</span><br><span class="line">                use : &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;file-loader?name=fonts/[name].[ext]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;public/index.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
其中的 <code>module</code>，就是 webpack 的 loader，都是用来打包用的：</li>
</ol>
<ul>
<li><strong>babel-loader</strong>：打包jsx、js文件，转化成浏览器认识的格式，因该loader配置选项较多，一般单抽取出独立的文件<code>.bebelrc</code>，放在项目根目录，webpack可以自动识别到</li>
<li><strong>css-loader</strong>，<strong>style-loader</strong>：打包css、style文件</li>
<li><strong>html-loader</strong>：打包html文件</li>
<li><strong>file-loader</strong>：打包其他格式文件，如配置中所写</li>
</ul>
<p><strong>.babelrc 内容如下：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [<span class="string">&quot;@babel/preset-react&quot;</span>, <span class="string">&quot;@babel/preset-env&quot;</span>], <span class="comment">// 支持的编码</span></span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，所有的loader、plugin，都需要手动安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install -D babel-core babel-loader css-loader style-loader html-loader file-loader</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install -D @babel/preset-env @babel/preset-react @babel/plugin-transform-runtime html-webpack-plugin</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>配置 package.json，使用webpack/webpack.config.js。修改 package.json 中的<code>scripts</code> 节点，如下：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --config webpack/webpack.config.js&quot;</span></span><br></pre></td></tr></table></figure>
此时，在项目根目录下执行该命令，即可。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run dev</span><br></pre></td></tr></table></figure>

<h4 id="五、配置-webpack-打包配置"><a href="#五、配置-webpack-打包配置" class="headerlink" title="五、配置 webpack 打包配置"></a>五、配置 webpack 打包配置</h4><p>和 server 类似，这里直接贴上配置文件</p>
<ol>
<li><strong>webpack/webpack.config.build.js</strong></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> __repo = path.dirname(__dirname);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    <span class="attr">entry</span>: path.resolve(__repo, <span class="string">&#x27;src/index.jsx&#x27;</span>),</span><br><span class="line">    <span class="attr">devtool</span>: <span class="string">&quot;#source-map&quot;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.resolve(__repo, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;app/[name].bundle.js&quot;</span>,</span><br><span class="line">        <span class="attr">publicPath</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/(\.jsx|\.js)$/</span>, <span class="comment">// 匹配所护理文件的扩展名正则表达式</span></span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 手动添加／屏蔽的文件</span></span><br><span class="line">                use: &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>, <span class="comment">// loader名称</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(css|styl)$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;style-loader&#x27;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.html$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;<span class="attr">loader</span>: <span class="string">&#x27;html-loader&#x27;</span>&#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(gif|jpg|png|svg|ttf|eot|woff|woff2)$/</span>,</span><br><span class="line">                use : &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;file-loader?name=fonts/[name].[ext]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;public/index.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>修改<code>package.json</code>中的scripts节点，如下</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config webpack/webpack.config.build.js&quot;</span></span><br></pre></td></tr></table></figure>
<p>执行打包命令后，所有文件会输出到项目根目录下的<code>dist</code>中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run build</span><br></pre></td></tr></table></figure>
<p>打包后的文件，配合<code>nginx</code>就可以访问请求了。</p>
<p><strong>（完）</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/d54bb8006555/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/d54bb8006555/" class="post-title-link" itemprop="url">管理 MacOS 上的 Python 环境版本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-09 01:26:02" itemprop="dateCreated datePublished" datetime="2021-06-09T01:26:02+08:00">2021-06-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="00-前言"><a href="#00-前言" class="headerlink" title="00.前言"></a>00.前言</h3><p>MacOS 上的 Python不同版本的环境一直是个让人头大的问题，原因在于，系统预先安装了2.7版本，但这是个老版本了，老版本是不能卸载的，一些系统程序都在依赖它。</p>
<p>现在市面上开发的新程序多数在用3.x版本，部分老代码还在用2.x版本，两个大版本还是有些区别的，无法完全兼容，这就让管理多版本共存成了个问题。</p>
<p>当然，也有一些管理工具，如pyenv，但其实python的venv模块已经足够了，下面会简单说一说使用。</p>
<h3 id="01-卸载干净"><a href="#01-卸载干净" class="headerlink" title="01.卸载干净"></a>01.卸载干净</h3><p>据不完全统计，目前发现了以下这些还算固定的安装目录：</p>
<ul>
<li><p>自己安装的Python在这个目录，即通过官网下载的安装程序安装<br>/Library/Frameworks/Python.framework</p>
</li>
<li><p>Python应用目录<br>/Applications/Python3.x</p>
</li>
<li><p>通过brew命令安装在这个目录，brew是个包管理工具，使用它安装的都在Cellar目录<br>/usr/local/Cellar</p>
</li>
<li><p>通过CommandLineTools安装在这个目录，这是个Xcode带的工具包<br>/Libaray/Developer/CommandLineTools/Library/Frameworks</p>
</li>
<li><p>系统预安装的在这个目录，这个看看就行了，不能删<br>/System/Library/Frameworks/Python.framework</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">which</span> python</span><br><span class="line">$ <span class="built_in">which</span> python3</span><br></pre></td></tr></table></figure>

<p>通过这两个命令，找到python可执行程序</p>
<ul>
<li>/usr/local/bin，这个目录下的，可以删除</li>
<li>/usr/bin，这个目录下的，想删也删不了，没权限。Catalina以下的通过关闭SIP可以操作/usr/bin目录下的文件，但以上的版本关掉SIP也不行了。我在早年间通过这种方式在/usr/bin目录下放了一个python3的可执行程序，现在升级到了Big Sur版本，导致这个可执行文件删不掉了，除了重装系统，我也没想到什么好办法，暂时就先这么放着。</li>
</ul>
<p>终端窗口执行python会进入2.7的交互解释环境，执行python3会报错command not found</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ python3</span><br><span class="line">-bash: python3: <span class="built_in">command</span> not found</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">which</span> python</span><br><span class="line">/usr/bin/python</span><br><span class="line"></span><br><span class="line">$ python</span><br><span class="line">WARNING: Python 2.7 is not recommended. </span><br><span class="line">This version is included <span class="keyword">in</span> macOS <span class="keyword">for</span> compatibility with legacy software. </span><br></pre></td></tr></table></figure>

<p>至此，现在系统里应该只剩下系统预安装的python2.7了，可执行文件在/usr/bin目录，同时/usr/local/bin目录不再有python可执行文件。</p>
<h3 id="02-安装最新"><a href="#02-安装最新" class="headerlink" title="02.安装最新"></a>02.安装最新</h3><p>直接用brew安装就好，别再用其他的各路神仙工具了，听我一句劝，不要在意别人怎么怂恿，就用brew就可以了，这个是macOS上最普遍、最通用的包管理工具，用最简单的方式做最大的事，多了不起。</p>
<p>如果不是新买的机器，应该都装了brew工具了，要是没装，那就先装一下，一行代码，等着就好了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ruby -e <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后，安装python3，一行代码，还是等着就好了，python3有多个版本，3.6、3.7、3.8以及最新的3.9，不指定版本会默认安装最新，如果有需要，可以指定版本：<a href="mailto:&#x70;&#121;&#116;&#x68;&#x6f;&#x6e;&#x40;&#x33;&#46;&#x78;">&#x70;&#121;&#116;&#x68;&#x6f;&#x6e;&#x40;&#x33;&#46;&#x78;</a>，如果同时存在多个3.x，要注意名字的区分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install python3</span><br></pre></td></tr></table></figure>

<p>这里唠叨几句pip，pip是python的包管理工具，前身是easy_install，这两者的关系是，python是可执行文件，pip是python的一个模块，可有也可无，非必需，建议还是用pip，毕竟其他方式管理包很麻烦。如果意外把pip删除了也可以单独安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">$ python3 -m ensurepip</span><br><span class="line">$ python3 -m pip install pip --upgrade</span><br><span class="line"><span class="comment"># 目标位置</span></span><br><span class="line">$ <span class="built_in">which</span> pip</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/pip</span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">$ python3 -m pip uninstall pip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认会安装这个三个，再安装用pip install &#123;package&#125;即可</span></span><br><span class="line">$ pip list -v</span><br><span class="line">pip          21.1.2    /usr/<span class="built_in">local</span>/lib/python3.9/site-packages     pip</span><br><span class="line">setuptools   57.0.0    /usr/<span class="built_in">local</span>/lib/python3.9/site-packages     pip</span><br><span class="line">wheel        0.36.2    /usr/<span class="built_in">local</span>/lib/python3.9/site-packages     pip</span><br></pre></td></tr></table></figure>

<p>一个pip关联一个python可执行文件，像上面这样，就是将pip关联到了python3，通过这个pip安装的包只有python3可调用到，系统自带的python调用不到，如果有需要，也可以为系统python可执行文件也装个pip工具，但要注意名字的区分</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">$ python -m ensurepip</span><br><span class="line"><span class="comment"># python是系统自带的，但没有操作系统目录的权限，所以需要加上--user</span></span><br><span class="line">$ python -m pip install pip --upgrade --user</span><br><span class="line"><span class="comment"># --user后会安装到当前用户目录库下，我的在这</span></span><br><span class="line">$ <span class="built_in">cd</span> /Users/&#123;username&#125;/Library/Python/2.7/bin</span><br><span class="line"><span class="comment"># 然后在pip同样的位置创建一个软连接就可以了</span></span><br><span class="line">$ ln -s /Users/&#123;username&#125;/Library/Python/2.7/bin/pip /usr/<span class="built_in">local</span>/bin/pip2</span><br><span class="line"><span class="comment"># 目标位置</span></span><br><span class="line">$ <span class="built_in">which</span> pip2</span><br><span class="line">/usr/<span class="built_in">local</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">python -m pip uninstall</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个就比较多了，而且都在系统目录里，咱也操作不了</span></span><br><span class="line"><span class="comment"># 再安装要加--user，这样会安装到当前用户目录库文件下: pip2 install &#123;package&#125; --user</span></span><br><span class="line"><span class="comment"># /Users/&#123;username&#125;/Library/Python/2.7/lib/python/site-packages</span></span><br><span class="line">$ pip2 list -v</span><br><span class="line">altgraph   0.10.2  /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python</span><br><span class="line">asn1crypto 0.24.0  /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python</span><br><span class="line">bdist-mpkg 0.5.0   /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python</span><br><span class="line">bonjour-py 0.3     /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python</span><br></pre></td></tr></table></figure>

<h3 id="03-日常使用"><a href="#03-日常使用" class="headerlink" title="03.日常使用"></a>03.日常使用</h3><p>日常使用是通过venv模块，一般一个项目使用一个venv环境，互相独立、互不干扰。</p>
<p>这种模式，就像是在一座大房子（机器）里可以建造很多不同类型（版本）的小房间（虚拟环境），每个小房间（虚拟环境）里的操作的影响范围只限于在这个房间（虚拟环境）内，各个房间（虚拟环境）互相独立互不影响，房间（虚拟环境）可以随时创建（新建）和拆除（删除）。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到项目的根目录下</span></span><br><span class="line">$ <span class="built_in">cd</span> PyProj</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个venv环境，第二个参数venvDir是环境目录的名称，一般使用venv，可随意，合法即可</span></span><br><span class="line">$ python3 -m venv venvDir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看虚拟环境，可看到如下内容</span></span><br><span class="line">$ ls -l venvDir</span><br><span class="line">drwxr-xr-x  12 username  staff  384 Jun  8 23:44 bin</span><br><span class="line">drwxr-xr-x   2 username  staff   64 Jun  8 23:44 include</span><br><span class="line">drwxr-xr-x   3 username  staff   96 Jun  8 23:44 lib</span><br><span class="line">-rw-r--r--   1 username  staff   90 Jun  8 23:44 pyvenv.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 激活当前venv环境，之后每行前面会多个(venvDir)，表示在该环境中</span></span><br><span class="line">$ <span class="built_in">source</span> venvDir/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看python可执行文件位置，此时在虚拟环境中，只有一个python，所以不要再输入python3</span></span><br><span class="line">(venvDir)$ <span class="built_in">which</span> python</span><br><span class="line">PyPorj/venvDir/bin/python</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看pip</span></span><br><span class="line">(venvDir)$ <span class="built_in">which</span> pip</span><br><span class="line">PyPorj/venvDir/bin/pip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时的python可执行程序和pip可执行程序只在当前环境内有效，若要退出当前环境则执行</span></span><br><span class="line">(venvDir)$ deactivate</span><br></pre></td></tr></table></figure>

<h3 id="04-附录"><a href="#04-附录" class="headerlink" title="04.附录"></a>04.附录</h3><ul>
<li><p>查看pip版本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip -V</span><br></pre></td></tr></table></figure></li>
<li><p>用pip安装package时，加上–user参数，会安装到当前用户的库目录中，只对当前用户有效，不加–user会安装到全局目录，对所有用户有效。如果你的电脑只有一个用户，那么二者没有区别</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ pip install --user</span><br><span class="line">～/Library/Python/3.9/lib/python/site-packages/</span><br><span class="line"></span><br><span class="line">$ pip install</span><br><span class="line">/usr/<span class="built_in">local</span>/lib/python3.9/site-packages/</span><br></pre></td></tr></table></figure>

<ul>
<li><p>brew安装目录<br>/usr/local/Cellar<br>Homebrew配置目录<br>/usr/lcoal/etc<br>Homebrew命令目录<br>/usr/local/bin</p>
</li>
<li><p>brew常用命令<br>brew install FORMULA<br>brew cleanup<br>bew searh FORMULA<br>brew info FORMULA<br>brew upgrade FORMULA<br>brew update</p>
</li>
</ul>
<p>（完）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/97c306187ae6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/97c306187ae6/" class="post-title-link" itemprop="url">Flask API 单元测试 unittest，mock && patch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-12 11:33:55" itemprop="dateCreated datePublished" datetime="2019-12-12T11:33:55+08:00">2019-12-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flask/" itemprop="url" rel="index"><span itemprop="name">Flask</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>单元测试，主要是为了测试某个方法，或是某个代码快，对于各种输入的处理，输出是否符合预期。但由于其他库、或模块的依赖，以至于很难独立测试我们自己实现的逻辑代码。</p>
<p>对此，引出 mock。</p>
<h2 id="一、Flask"><a href="#一、Flask" class="headerlink" title="一、Flask"></a>一、Flask</h2><p><strong>Flask</strong>是个轻量 API 框架，使用起来非常容易上手</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装：pip install flask</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello Flask&#x27;</span></span><br><span class="line"></span><br><span class="line">app.run(port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<p>这样，一个简单的 server 就跑起来了，访问 <strong>http:localhost:5000</strong> 便可以看到返回的数据：<strong>Hello Flask</strong></p>
<p>下面举例说明，如果对单一的接口写测试用例</p>
<h2 id="二、举例：用户登录"><a href="#二、举例：用户登录" class="headerlink" title="二、举例：用户登录"></a>二、举例：用户登录</h2><ol>
<li>用户登录是个常见的功能接口，接口逻辑之外的部分基本同上，这里省略不写。用户使用 <strong>name</strong> 和 <strong>password</strong> 进行登陆操作，服务器收到请求后，根据 <strong>name</strong> 从数据库查询 <strong>password</strong> ，一致则返回 <strong>200 OK</strong>，不一致返回 <strong>400 Bad Request</strong>，很简单的实现，如下： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> app.model <span class="keyword">import</span> UserDB</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> name:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;name is required&#x27;</span>, <span class="number">400</span></span><br><span class="line">   </span><br><span class="line">    password = request.args.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;password is required&#x27;</span>, <span class="number">400</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 从数据库获取用户数据</span></span><br><span class="line">    user = UserDB.get_user(name)</span><br><span class="line">    <span class="keyword">if</span> user.get(<span class="string">&#x27;password&#x27;</span>) == password:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;OK&#x27;</span>, <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;password is wrong&#x27;</span>, <span class="number">400</span></span><br></pre></td></tr></table></figure>
 其中 <strong>UserDB</strong> 为数据模块中，从数据库查询用户数据的类。这里对于<strong>登录逻辑</strong>的单元测试，只指测试该部分最小的代码块，对于代码块中引入的依赖，在测试时都认为是正常的。例如，在测试 <strong>login()</strong> 的时候，我们认为 <strong>UserDB</strong> 是正常的、可用的，至于 <strong>UserDB</strong> 的可靠性，需要 <strong>UserDB</strong> 模块的单元测试来保障。<br> 对于待测试模块内引入的依赖，采用 <strong>mock</strong> 的方式模拟。</li>
<li><strong>Flask</strong> 的单元测试，先看代码 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> Mock</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> patch</span><br><span class="line"><span class="comment"># 该app为创建的Flask实例</span></span><br><span class="line"><span class="keyword">from</span> application <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app.model <span class="keyword">import</span> UserDB</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># push一个上下文，便可以使用flask中的全局变量，如g</span></span><br><span class="line">        app.app_context().push()</span><br><span class="line">        app.testing = <span class="literal">True</span></span><br><span class="line">        <span class="comment"># 测试用的http client</span></span><br><span class="line">        self.client = app.test_client()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_login_success</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 真实请求中的url，host和port可省略</span></span><br><span class="line">        url = <span class="string">&#x27;/login?name=flask&amp;password=flaskpassword&#x27;</span></span><br><span class="line">        <span class="comment"># 模拟的方法名称，也可直接写字符串： get_user</span></span><br><span class="line">        func_name = UserDB.get_user.__name__</span><br><span class="line">        <span class="comment"># 模拟的方法，不管请求参数是什么，都会返回return_value的值（Mock还有其他用法）</span></span><br><span class="line">        mock_func = Mock(return_value=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;flask&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;flaskpassword&#x27;</span>&#125;)</span><br><span class="line">        <span class="comment"># patch意为，当UserDB的get_user方法被调用时，用mock出来的func来处理</span></span><br><span class="line">        <span class="comment"># 而mock的func，不管请求参数，都会返回return_value</span></span><br><span class="line">        <span class="comment"># 故而，只要UserDB的get_user被调用，都会返回&#123;&#x27;name&#x27;: &#x27;flask&#x27;, &#x27;password&#x27;: &#x27;flaskpassword&#x27;&#125;</span></span><br><span class="line">        <span class="comment"># with，表示这种处理方式的作用范围</span></span><br><span class="line">        <span class="comment"># 当在with的范围之外时，调用UserDB的get_user不受mock影响，会正常调用</span></span><br><span class="line">        <span class="keyword">with</span> patch.<span class="built_in">object</span>(UserDB, func_name, func):</span><br><span class="line">            <span class="comment"># response为返回的响应</span></span><br><span class="line">            response = self.client.get(url)</span><br><span class="line">            <span class="comment"># 因为传入的name和password，和UserDB的mock func返回的name和password相同</span></span><br><span class="line">            <span class="comment"># 所以，该请求会返回200</span></span><br><span class="line">            <span class="comment"># assertEqual意为，认定返回码与200相等，若不等则该用例不通过</span></span><br><span class="line">            self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">       </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_login_failed</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试传入错误密码的情况</span></span><br><span class="line">        url = <span class="string">&#x27;/login?name=flask&amp;password=wrongpassword&#x27;</span></span><br><span class="line">        func_name = UserDB.get_user.__name__</span><br><span class="line">        mock_func = Mock(return_value=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;flask&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;flaskpassword&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">with</span> patch.<span class="built_in">object</span>(UserDB, func_name, func):</span><br><span class="line">            response = self.client.get(url)</span><br><span class="line">            <span class="comment"># 因为传入密码错误，所以在此我们认定返回码是400</span></span><br><span class="line">            self.assertEqual(response.status_code, <span class="number">400</span>)</span><br></pre></td></tr></table></figure>
 此外，还可以对测试缺少参数，这里不再赘述。这样，便可对接口的各种情况进行测试了。</li>
</ol>
<p><strong>（完）</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/4ae565dbddd3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/4ae565dbddd3/" class="post-title-link" itemprop="url">RHEL(Red Hat Enterprise Linux) 安装 zip、unzip</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-28 19:05:24" itemprop="dateCreated datePublished" datetime="2019-11-28T19:05:24+08:00">2019-11-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>216</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>多数的系统镜像文件中都是包含这两个命令，但总有意外。</p>
</blockquote>
<ul>
<li>一般方法<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install zip unzip</span><br></pre></td></tr></table></figure></li>
<li>如果一般方法报错，这个是安装unzip<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rpm -ivh https://rpmfind.net/linux/mageia/distrib/cauldron/x86_64/media/core/release/unzip-6.1c-6.mga8.x86_64.rpm</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="其他版本的系统，链接从这里找-gt-点一下呗"><a href="#其他版本的系统，链接从这里找-gt-点一下呗" class="headerlink" title="其他版本的系统，链接从这里找 -&gt; 点一下呗"></a>其他版本的系统，链接从这里找 -&gt; <a target="_blank" rel="noopener" href="https://rpmfind.net/linux/rpm2html/search.php?query=unzip">点一下呗</a></h5><p>(完)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/fda8ed989b0e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/fda8ed989b0e/" class="post-title-link" itemprop="url">yum 安装最新版本 mysql</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-25 17:28:07" itemprop="dateCreated datePublished" datetime="2019-11-25T17:28:07+08:00">2019-11-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一-先到官网查询最新的版本，官网地址"><a href="#一-先到官网查询最新的版本，官网地址" class="headerlink" title="一. 先到官网查询最新的版本，官网地址"></a>一. 先到官网查询最新的版本，<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/repo/yum/">官网地址</a></h4><p>注意选择自己Linux对应的版本，查询方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /etc/*-release</span></span><br><span class="line">NAME=&quot;Red Hat Enterprise Linux Server&quot;</span><br><span class="line">VERSION=&quot;7.7 (Maipo)&quot;</span><br><span class="line">......</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> uname -m</span></span><br><span class="line">x86_64</span><br></pre></td></tr></table></figure>
<p>根据以上信息，选择所需版本的 rpm 名称，如图<br><img src="https://i.loli.net/2021/07/07/JsqNMBWZcmKpEXu.png"></p>
<h4 id="二-安装、启动"><a href="#二-安装、启动" class="headerlink" title="二. 安装、启动"></a>二. 安装、启动</h4><ol>
<li>下载 rpm 文件。可以在网页上点 Download，然后在传送到服务器，也可以直接在服务器上下载，如下，替换链接后面部分即可： <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://repo.mysql.com/mysql80-community-release-el7-3.noarch.rpm</span><br></pre></td></tr></table></figure></li>
<li>导入 yum repo。 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br></pre></td></tr></table></figure></li>
<li>安装 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install mysql-server</span><br></pre></td></tr></table></figure></li>
<li>启动 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start mysqld.service</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="三-连接、密码"><a href="#三-连接、密码" class="headerlink" title="三. 连接、密码"></a>三. 连接、密码</h4><ol>
<li>连接 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p</span><br></pre></td></tr></table></figure></li>
<li>如果需要密码，去 <code>/var/log/mysqld.log</code>里面找，格式类似如下，<code>5Vgr6&gt;Go.Azi</code>即是 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-11-25T08:46:57.138469Z 5 [Note] [MY-010454] [Server] A temporary password is generated <span class="keyword">for</span> root@localhost: 5Vgr6&gt;Go.Azi</span><br></pre></td></tr></table></figure></li>
<li>登陆成功之后，如果提示用<code>ALTER USER</code>修改密码，如下 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;new_password&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li>如果提示密码不合格，查看一下当前密码要求，如下，length表示密码最小长度，mixed_case_count表示大小写字母混合数量，number_count表示数字数量，special_char_count表示特殊字符数量 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;validate_password%&#x27;</span>;</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| Variable_name                        | Value  |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| validate_password.check_user_name    | ON     |</span><br><span class="line">| validate_password.dictionary_file    |        |</span><br><span class="line">| validate_password.length             | 6      |</span><br><span class="line">| validate_password.mixed_case_count   | 1      |</span><br><span class="line">| validate_password.number_count       | 1      |</span><br><span class="line">| validate_password.policy             | MEDIUM |</span><br><span class="line">| validate_password.special_char_count | 0      |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">7 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>如果想设置个简单好记的密码，修改一下密码检查，exit退出mysql，再连接登陆后生效 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password.mixed_case_count=0;</span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password.special_char_count=0;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>(完)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/6e1530768100/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/6e1530768100/" class="post-title-link" itemprop="url">nginx路由匹配</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-25 14:10:06" itemprop="dateCreated datePublished" datetime="2019-11-25T14:10:06+08:00">2019-11-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>57</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>=<br>精确匹配</li>
<li>^~<br>精确前缀匹配</li>
<li>~<br>正则匹配（大小写敏感）</li>
<li>~*<br>正则匹配（大小写不敏感）</li>
<li>/uri<br>普通前缀匹配</li>
<li>/<br>通用匹配</li>
</ol>
<p>(完)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/5e5a9e36111c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/5e5a9e36111c/" class="post-title-link" itemprop="url">nginx 转发错误 13 permission denied</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-24 00:19:25" itemprop="dateCreated datePublished" datetime="2019-11-24T00:19:25+08:00">2019-11-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>423</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<p>今天在做 nginx 转发的时候，总是权限的错误：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019/11/23 14:22:28 [crit] 19986<span class="comment">#19986: *1 connect() to 127.0.0.1:5050 failed (13: Permission denied) while connecting</span></span><br></pre></td></tr></table></figure>
<p>从网上翻了翻，大多数文章都在说修改 nginx 用户，而且这些文章的内容还都是一样的，这让着急解决问题的我很恼火….不知道是一个人写完在各个地方发了一遍，还是别的什么，我没无聊到查这些… -_-</p>
<p>修改 nginx 配置文件，<code>/etc/nginx/nginx.conf</code>，改成 root</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user root</span><br></pre></td></tr></table></figure>

<p>然后用 root 权限 restart nginx 服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>一般到这就结束了，但是却还没解决我的问题，权限问题依然在。又在网上一番找，原来是 linux 给拦截了，暂时关掉就可以了 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/songxingzhu/p/10063043.html">链接</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ setenforce 0                  <span class="comment">##设置SELinux 成为permissive模式</span></span><br></pre></td></tr></table></figure>
<p>(完)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/c712d783ad18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/c712d783ad18/" class="post-title-link" itemprop="url">ELK 单机部署，多 beat 节点</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-17 23:31:35" itemprop="dateCreated datePublished" datetime="2019-11-17T23:31:35+08:00">2019-11-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ELK/" itemprop="url" rel="index"><span itemprop="name">ELK</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sparkdev/p/10554076.html">参考文章</a></p>
<p>适用场景：多个项目或服务，独立部署，各个服务有自己的 log 文件。为便于查看、过滤等，可单机部署 ELK 服务后，各个服务通过 filebeat 服务将 log 发送至 ELK 机器。</p>
<p><img src="https://i.loli.net/2021/07/07/rNvnGcQ4SyhpZlf.png"></p>
<h4 id="一、安装-java"><a href="#一、安装-java" class="headerlink" title="一、安装 java"></a>一、安装 java</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install java</span><br><span class="line"></span><br><span class="line">$ java -version</span><br><span class="line">openjdk version <span class="string">&quot;11.0.5&quot;</span> 2019-10-15 LTS</span><br><span class="line">OpenJDK Runtime Environment Corretto-11.0.5.10.1 (build 11.0.5+10-LTS)</span><br><span class="line">OpenJDK 64-Bit Server VM Corretto-11.0.5.10.1 (build 11.0.5+10-LTS, mixed mode)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于 elasticsearch、logstash 和 kibana，<strong>Elastic.co</strong> 都提供了多种环境的安装方式，这里只介绍通过 RPM 的方式，其他环境可参考<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/index.html">官网文档</a>。</p>
</blockquote>
<h4 id="二、安装-elasticsearch"><a href="#二、安装-elasticsearch" class="headerlink" title="二、安装 elasticsearch"></a>二、安装 elasticsearch</h4><ol>
<li>下载安装公钥。 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br></pre></td></tr></table></figure></li>
<li>增加 yum 源。在 <code>/etc/yum.repos.d/</code> 创建文件 <code>elasticsearch.repo</code> 并写入以下内容: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[elasticsearch-7.x]</span><br><span class="line">name=Elasticsearch repository <span class="keyword">for</span> 7.x packages</span><br><span class="line">baseurl=https://artifacts.elastic.co/packages/7.x/yum</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br></pre></td></tr></table></figure></li>
<li>安装、启动 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install elasticsearch</span><br><span class="line"></span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> elasticsearch.service</span><br><span class="line"> Created symlink from /etc/systemd/system/multi-user.target.wants/elasticsearch.service to /usr/lib/systemd/system/elasticsearch.service.</span><br><span class="line"></span><br><span class="line">$ sudo systemctl start elasticsearch.service</span><br><span class="line"></span><br><span class="line">$ sudo systemctl | grep elasticsearch</span><br><span class="line"> elasticsearch.service   loaded active running   Elasticsearch</span><br></pre></td></tr></table></figure>
 <strong>注意</strong>：elasticsearch 基于 java，默认占用的最小内存是 1G，如果机器内存不够启动时会报错 <code>Not enough space</code>，将 <code>/etc/elasticsearch/jvm.options</code> 中的 <code>-Xms</code> 和 <code>-Xmx</code> 改小后重试即可。</li>
</ol>
<h4 id="三、安装-logstash"><a href="#三、安装-logstash" class="headerlink" title="三、安装 logstash"></a>三、安装 logstash</h4><ol>
<li>下载安装公钥。如果上面执行过，可跳过。 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br></pre></td></tr></table></figure></li>
<li>增加 yum 源。在 <code>/etc/yum.repos.d/</code> 创建文件 <code>logstash.repo</code> 并写入以下内容: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[logstash-7.x]</span><br><span class="line">name=Elastic repository <span class="keyword">for</span> 7.x packages</span><br><span class="line">baseurl=https://artifacts.elastic.co/packages/7.x/yum</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br></pre></td></tr></table></figure></li>
<li>安装 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install logstash</span><br><span class="line">	</span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line">	</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> logstash.service</span><br><span class="line"> Created symlink from /etc/systemd/system/multi-user.target.wants/logstash.service to /etc/systemd/system/logstash.service.</span><br></pre></td></tr></table></figure></li>
<li>配置。在 <code>/etc/logstash/conf.d/</code> 创建文件 <code>beat2es.conf</code>，并写入以下内容： <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    beats&#123;</span><br><span class="line">        <span class="function"><span class="params">port</span> =&gt;</span> <span class="number">5044</span></span><br><span class="line">        ssl =&gt; <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">        <span class="function"><span class="params">match</span> =&gt;</span> &#123; <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;TIMESTAMP_ISO8601:[@metadata][timestamp]&#125; %&#123;DATA:message&quot;</span> &#125;</span><br><span class="line">        overwrite =&gt; [ <span class="string">&quot;message&quot;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">    date &#123;</span><br><span class="line">        <span class="function"><span class="params">match</span> =&gt;</span> [ <span class="string">&quot;[@metadata][timestamp]&quot;</span> , <span class="string">&quot;yyyy-MM-dd HH:mm:ss,SSS&quot;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        <span class="function"><span class="params">hosts</span> =&gt;</span> [<span class="string">&quot;localhost:9200&quot;</span>]</span><br><span class="line">        index =&gt; <span class="string">&quot;%&#123;[fields][appname]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span></span><br><span class="line">        sniffing =&gt; <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>启动 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start logstash</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="四、安装-kibana"><a href="#四、安装-kibana" class="headerlink" title="四、安装 kibana"></a>四、安装 kibana</h4><ol>
<li>下载安装公钥。如果上面执行过，可跳过。 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br></pre></td></tr></table></figure></li>
<li>增加 yum 源。在 <code>/etc/yum.repos.d/</code> 创建文件 <code>kibana.repo</code> 并写入以下内容: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[kibana-7.x]</span><br><span class="line">name=Kibana repository <span class="keyword">for</span> 7.x packages</span><br><span class="line">baseurl=https://artifacts.elastic.co/packages/7.x/yum</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br></pre></td></tr></table></figure></li>
<li>安装、启动 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install kibana</span><br><span class="line"></span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> kibana.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/kibana.service to /etc/systemd/system/kibana.service.</span><br><span class="line">	</span><br><span class="line">$ sudo systemctl start kibana.service</span><br></pre></td></tr></table></figure></li>
</ol>
<h6 id="至此，ELK-服务已经部署完成。logstash-监听-5044-端口，所有发送到-5044-端口的内容都会传送至-elasticsearch，可通过-kibana-可视化搜索页面进行查询。"><a href="#至此，ELK-服务已经部署完成。logstash-监听-5044-端口，所有发送到-5044-端口的内容都会传送至-elasticsearch，可通过-kibana-可视化搜索页面进行查询。" class="headerlink" title="至此，ELK 服务已经部署完成。logstash 监听 5044 端口，所有发送到 5044 端口的内容都会传送至 elasticsearch，可通过 kibana 可视化搜索页面进行查询。"></a>至此，ELK 服务已经部署完成。logstash 监听 5044 端口，所有发送到 5044 端口的内容都会传送至 elasticsearch，可通过 kibana 可视化搜索页面进行查询。</h6><h6 id="kibana-默认部署在-locaohost-5601，为了增加安全性，需通过-nginx-为-kibana-设置用户登陆访问。"><a href="#kibana-默认部署在-locaohost-5601，为了增加安全性，需通过-nginx-为-kibana-设置用户登陆访问。" class="headerlink" title="kibana 默认部署在 locaohost:5601，为了增加安全性，需通过 nginx 为 kibana 设置用户登陆访问。"></a>kibana 默认部署在 locaohost:5601，为了增加安全性，需通过 nginx 为 kibana 设置用户登陆访问。</h6><h6 id="如果不需要安全性，可修改-etc-kibana-kibana-yml-文件，将其中的-server-host-的值改为-0-0-0-0-后重启-kibana-服务，这样外网可直接通过该机器的-5601-端口访问-kibana-服务。"><a href="#如果不需要安全性，可修改-etc-kibana-kibana-yml-文件，将其中的-server-host-的值改为-0-0-0-0-后重启-kibana-服务，这样外网可直接通过该机器的-5601-端口访问-kibana-服务。" class="headerlink" title="如果不需要安全性，可修改 /etc/kibana/kibana.yml 文件，将其中的 server.host 的值改为 0.0.0.0 后重启 kibana 服务，这样外网可直接通过该机器的 5601 端口访问 kibana 服务。"></a>如果不需要安全性，可修改 <code>/etc/kibana/kibana.yml</code> 文件，将其中的 <code>server.host</code> 的值改为 <code>0.0.0.0</code> 后重启 kibana 服务，这样外网可直接通过该机器的 5601 端口访问 kibana 服务。</h6><h4 id="五、设置-kibana-登陆访问"><a href="#五、设置-kibana-登陆访问" class="headerlink" title="五、设置 kibana 登陆访问"></a>五、设置 kibana 登陆访问</h4><ol>
<li>添加 nginx 源 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br></pre></td></tr></table></figure></li>
<li>安装 nginx <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install nginx</span><br></pre></td></tr></table></figure></li>
<li>配置 nginx。修改 <code>/etc/nginx/conf.d/default.conf</code> 中 <code>/</code> 路由的配置，如下： <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">     auth_basic <span class="string">&quot;secret&quot;</span>;</span><br><span class="line">     auth_basic_user_file /etc/nginx/db/passwd.db;</span><br><span class="line">     proxy_pass http://localhost:5601;</span><br><span class="line">     proxy_set_header Host <span class="variable">$host</span>:5601;</span><br><span class="line">     proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">     proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">     proxy_set_header Via <span class="string">&quot;nginx&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li>安装 httpd <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install httpd</span><br></pre></td></tr></table></figure></li>
<li>设置用户。用户名：jack，密码：123456 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo htpasswd -bc /etc/nginx/pwd.db jack 123456</span><br></pre></td></tr></table></figure></li>
<li>启动 nginx <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl nginx.service</span><br></pre></td></tr></table></figure></li>
</ol>
<h6 id="至此，访问该机器的-80-端口，通过用户密码验证，即可访问到-kibana-服务。"><a href="#至此，访问该机器的-80-端口，通过用户密码验证，即可访问到-kibana-服务。" class="headerlink" title="至此，访问该机器的 80 端口，通过用户密码验证，即可访问到 kibana 服务。"></a>至此，访问该机器的 80 端口，通过用户密码验证，即可访问到 kibana 服务。</h6><h4 id="六、安装-filebeat"><a href="#六、安装-filebeat" class="headerlink" title="六、安装 filebeat"></a>六、安装 filebeat</h4><blockquote>
<p>filebeat 服务可安装在任何有 log 文件的机器上，其实时监听 log 文件，并将内容发送至 logstash 服务。</p>
</blockquote>
<ol>
<li><p>下载 rpm 文件，并安装</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.4.2-x86_64.rpm</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 22.7M  100 22.7M    0     0  24.8M      0 --:--:-- --:--:-- --:--:-- 24.8M</span><br><span class="line"></span><br><span class="line">$ sudo rpm -vi filebeat-7.4.2-x86_64.rpm</span><br><span class="line">Preparing packages...</span><br><span class="line">filebeat-7.4.2-1.x86_64</span><br><span class="line"></span><br><span class="line">$ filebeat version</span><br><span class="line">filebeat version 7.4.2 (amd64), libbeat 7.4.2 [15075156388b44390301f070960fd8aeac1c9712built 2019-10-28 19:46:13 +0000 UTC]</span><br></pre></td></tr></table></figure></li>
<li><p>配置。配置文件按模块分为了几部分，如 Filebeat inputs、Filebeat modules、Outputs等，在这里只需关心两个模块，一是 Filebeat inputs，另个为 Outputs。<br>Filebeat inputs 用来配置 Filebeat 服务所监听、读取的文件，以及读取时的一些选项，这里的文件，即为 log 文件。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">enabled: true 表示开启</span><br><span class="line">	</span><br><span class="line">paths: 指定 log 文件的路径</span><br><span class="line">	</span><br><span class="line">fields: 配置元数据，appname 为必填项，用来区分不同项目</span><br><span class="line">	</span><br><span class="line">multiline.pattern: 正则表达式</span><br><span class="line">	</span><br><span class="line">multiline.negate: 是否反向。true 表示匹配 multiline.pattern 时开始新的一行；false 表示不匹配时开始新的一行</span><br><span class="line">	</span><br><span class="line">multiline.match: 连接的位置。after 表示不匹配 multiline.pattern 时连在上一句后面；before 表示连在下一句前面</span><br><span class="line">	</span><br><span class="line">这 3 项用来设置多行识别，&#x27;^[0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;&#x27; 是识别，行首格式为 YYYY-MM-DD 的日期，即每当行首为该格式的日期时，如 2019-11-15，都会重新开始一行。</span><br></pre></td></tr></table></figure>

<p>Outputs 用来配置读取到的内容，如何输出。配置里缺省的输出方向是 Elasticsearch，这里需要切换为 Logstash。Logstash 的 SSL 目前尚未开启，因此只需配置 hosts 即可。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hosts: [&quot;&#123;host&#125;:5044&quot;]，logstash 服务所在的主机地址</span><br></pre></td></tr></table></figure>

<p>如无特殊需求，修改下面内容中的 <code>paths</code> 和 <code>appname</code> 以及 <code>hosts</code>，替换原 filebeat.yml 文件内容，即可。</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">#=========================== Filebeat inputs =============================</span></span><br><span class="line"> </span><br><span class="line">filebeat.inputs:</span><br><span class="line"> </span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/app.log</span><br><span class="line">  fields:</span><br><span class="line">    appname: &#123;your-app-name&#125;</span><br><span class="line">  multiline.pattern: <span class="string">&#x27;^[0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;&#x27;</span></span><br><span class="line">  multiline.negate: <span class="literal">true</span></span><br><span class="line">  multiline.match: after</span><br><span class="line"> </span><br><span class="line"><span class="comment">#============================= Filebeat modules ===============================</span></span><br><span class="line"> </span><br><span class="line">filebeat.config.modules:</span><br><span class="line">  <span class="comment"># Glob pattern for configuration loading</span></span><br><span class="line">  path: <span class="variable">$&#123;path.config&#125;</span>/modules.d/*.yml</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Set to true to enable config reloading</span></span><br><span class="line">  reload.enabled: <span class="literal">false</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#==================== Elasticsearch template setting ==========================</span></span><br><span class="line"> </span><br><span class="line">setup.template.settings:</span><br><span class="line">  index.number_of_shards: 1</span><br><span class="line">  <span class="comment">#index.codec: best_compression</span></span><br><span class="line">  <span class="comment">#_source.enabled: false</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#================================ Outputs =====================================</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#----------------------------- Logstash output --------------------------------</span></span><br><span class="line">output.logstash:</span><br><span class="line">  <span class="comment"># The Logstash hosts</span></span><br><span class="line">  hosts: [<span class="string">&quot;&#123;host&#125;:5044&quot;</span>]</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Optional SSL. By default is off.</span></span><br><span class="line">  <span class="comment"># List of root certificates for HTTPS server verifications</span></span><br><span class="line">  <span class="comment">#ssl.certificate_authorities: [&quot;/etc/pki/root/ca.pem&quot;]</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Certificate for SSL client authentication</span></span><br><span class="line">  <span class="comment">#ssl.certificate: &quot;/etc/pki/client/cert.pem&quot;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Client Certificate Key</span></span><br><span class="line">  <span class="comment">#ssl.key: &quot;/etc/pki/client/cert.key&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#================================ Processors =====================================</span></span><br><span class="line"> </span><br><span class="line">processors:</span><br><span class="line">  - add_host_metadata: ~</span><br><span class="line">  - add_cloud_metadata: ~</span><br></pre></td></tr></table></figure></li>
<li><p>启动</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> filebeat.service</span><br><span class="line"></span><br><span class="line">$ sudo systemctl start filebeat.service</span><br></pre></td></tr></table></figure></li>
</ol>
<p>(完)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/ced3db1f808e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ced3db1f808e/" class="post-title-link" itemprop="url">保持ssh远程连接不断开</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-18 23:02:15" itemprop="dateCreated datePublished" datetime="2019-09-18T23:02:15+08:00">2019-09-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>436</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>通过<code>ssh user@server</code>登陆到远程服务器时，经常会遇到一个问题，</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection closed by remote host</span><br></pre></td></tr></table></figure>
<p>意思就是服务器断开了这个连接。</p>
<h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 先登录到远程服务器</span><br><span class="line">$ ssh -i ./ssh/authorization.pem &#123;root&#125;@&#123;server&#125;</span><br><span class="line"></span><br><span class="line">// 切换到root</span><br><span class="line">$ sudo su -</span><br><span class="line"></span><br><span class="line">// 修改配置文件</span><br><span class="line"><span class="comment"># vi /etc/ssh/sshd_config</span></span><br><span class="line"></span><br><span class="line">// 将其中的两行</span><br><span class="line"><span class="comment">#ClientAliveInterval 0</span></span><br><span class="line"><span class="comment">#ClientAliveCountMax 3</span></span><br><span class="line">// 修改为</span><br><span class="line">ClientAliveInterval 2</span><br><span class="line">ClientAliveCountMax 3</span><br><span class="line">// :wq 保存，并退出</span><br><span class="line"></span><br><span class="line">// 重启ssh服务</span><br><span class="line"><span class="comment"># /etc/init.d/sshd restart</span></span><br><span class="line">Stopping sshd:                                             [  OK  ]</span><br><span class="line">Starting sshd:                                             [  OK  ]</span><br></pre></td></tr></table></figure>

<p>断开当前ssh连接，重新登录，问题解决。</p>
<p>(完)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/6df5f8cca1a9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="oynix">
      <meta itemprop="description" content="避免没有计划的行动">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="oynix">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/6df5f8cca1a9/" class="post-title-link" itemprop="url">在AWS Lambda中使用psycopg2连接Redshift</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-17 22:55:54" itemprop="dateCreated datePublished" datetime="2019-09-17T22:55:54+08:00">2019-09-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>环境：MacOS 10.12.6</li>
</ul>
<p>开始说正题。</p>
<p>Redshift是基于PostgreSQL的二次开发应用，所以，能连接PostgreSQL的工具都可以用来连接Redshift。我选择的是使用最广泛的<code>psycopg2</code>。</p>
<p>如果上来就执行:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install psycopg2</span><br></pre></td></tr></table></figure>
<p>你会看到下面的提示错误：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Error: pg_config executable not found.</span><br><span class="line">    </span><br><span class="line">    pg_config is required to build psycopg2 from <span class="built_in">source</span>.  Please add the directory</span><br><span class="line">    containing pg_config to the <span class="variable">$PATH</span> or specify the full executable path with the</span><br><span class="line">    option:</span><br><span class="line">    </span><br><span class="line">        python setup.py build_ext --pg-config /path/to/pg_config build ...</span><br><span class="line">    </span><br><span class="line">    or with the pg_config option <span class="keyword">in</span> <span class="string">&#x27;setup.cfg&#x27;</span>.</span><br><span class="line">    </span><br><span class="line">    If you prefer to avoid building psycopg2 from <span class="built_in">source</span>, please install the PyPI</span><br><span class="line">    <span class="string">&#x27;psycopg2-binary&#x27;</span> package instead.</span><br><span class="line">    </span><br><span class="line">    For further information please check the <span class="string">&#x27;doc/src/install.rst&#x27;</span> file (also at</span><br><span class="line">    &lt;http://initd.org/psycopg/docs/install.html&gt;).</span><br><span class="line">    </span><br><span class="line">    ----------------------------------------</span><br><span class="line">ERROR: Command errored out with <span class="built_in">exit</span> status 1: python setup.py egg_info Check the logs <span class="keyword">for</span> full <span class="built_in">command</span> output.</span><br></pre></td></tr></table></figure>
<p>提示需要一个叫做<code>pg_config</code>的东西。<code>pg_config</code>是个编译PostgreSQL源码后得到的一个文件。所以想要通过这种方式安装<code>psycopg2</code>就需要手动去编译源码。</p>
<p>如果懒得编译，人家已经替你想好了办法，正如提示里所言，</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">If you prefer to avoid building psycopg2 from <span class="built_in">source</span>, please install the PyPI</span><br><span class="line">   <span class="string">&#x27;psycopg2-binary&#x27;</span> package instead.</span><br></pre></td></tr></table></figure>
<p>因此，通过下面命令安装删减版的<code>psycopg2</code>，</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install psycopg2-binary</span><br></pre></td></tr></table></figure>
<p>然后，在本机上就可以正常使用了。</p>
<hr>
<p><strong>但是，Lambda不可以。不同于独立的机器，Lambda需要完整的依赖包才能执行。</strong></p>
<p>在Github上搜到了<a target="_blank" rel="noopener" href="https://github.com/jkehler/awslambda-psycopg2">awslambda-psycopg2</a>，作者介绍说是专门解决在Lambda上使用<code>psycopg2</code>的。</p>
<p>按照<code>README.md</code>的步骤，先编译PostgreSQL，再用生成的<code>pg_config</code>去编译<code>psycopg2</code>。但执行后总会报一个错误，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No module named <span class="string">&#x27;psycopg2._psycopg&#x27;</span></span><br></pre></td></tr></table></figure>
<p>看着<a target="_blank" rel="noopener" href="https://github.com/jkehler/awslambda-psycopg2/issues/47">issue</a>里面几个老外说来说去，也没说出个可行的解决方案。</p>
<p>几番尝试下来，终究是填了坑。</p>
<p><strong>其实是编译环境的问题，在什么环境下编译生成的依赖包，只能在该环境下使用。Lambda是在Linux机器上执行的，所以必须在Linux上进行编译，生成的依赖包才可以使用。</strong></p>
<p>就是这么简单。</p>
<p><img src="https://i.loli.net/2021/07/07/IX1DjFi72OblPoG.png"></p>
<p>(完)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">oynix</p>
  <div class="site-description" itemprop="description">避免没有计划的行动</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">40</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/oynix" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;oynix" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:oynix@foxmail.com" title="E-Mail → mailto:oynix@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">oynix</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">109k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:39</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
